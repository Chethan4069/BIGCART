<!DOCTYPE html>
<html lang="en">
<head>
    <title>Big cart - Login & Register</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Core CSS -->
    <link rel="stylesheet" href="styles/bootstrap4/bootstrap.min.css">
    <link rel="stylesheet" href="plugins/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="styles/main_styles.css">
    <link rel="stylesheet" href="styles/responsive.css">

    <style>
        .auth_container { padding:80px 0; background:#f8f8f8; margin-top:80px; }
        .auth_box {
            background:#fff; padding:40px; border-radius:5px;
            box-shadow:0 0 15px rgba(0,0,0,0.1); max-width:550px; margin:0 auto;
        }
        .auth_box h2 { text-align:center; margin-bottom:30px; color:#333; }
        .form-group label { font-weight:500; margin-bottom:8px; }
        .form-control { height:48px; border-radius:3px; border:1px solid #ddd; padding:0 15px; }
        .red_button { width:100%; margin-top:20px; background:#fe4c50; color:#fff; border:none; height:48px; border-radius:3px; font-weight:bold; }
        .auth_tabs { display:flex; justify-content:center; margin-bottom:30px; }
        .auth_tabs button {
            flex:1; padding:12px; border:none; outline:none; cursor:pointer;
            background:#f1f1f1; color:#333; font-weight:500; transition:0.3s;
        }
        .auth_tabs button.active { background:#fe4c50; color:#fff; }
        .tab_content { display:none; }
        .tab_content.active { display:block; }
        .link_text { text-align:center; margin-top:15px; }
        .link_text a { color:#fe4c50; font-weight:500; text-decoration:none; }
        /* Style for the message box */
        #message-box { 
            padding: 15px; 
            margin-bottom: 20px; 
            border-radius: 5px; 
            display: none; /* Hidden by default */
            font-weight: 500;
        }
        #message-box.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        #message-box.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>

<body>
<div class="super_container">

    <!-- Header -->
    <header class="header trans_300">
        <div class="top_nav"><div class="container"><div class="row"><div class="col-md-6"><div class="top_nav_left">free shipping on all INR orders over $50</div></div><div class="col-md-6 text-right"><div class="top_nav_right"><ul class="top_nav_menu"><li class="currency"><a href="#">INR <i class="fa fa-angle-down"></i></a><ul class="currency_selection"><li><a href="#">USD</a></li></ul></li><li class="language"><a href="#">English <i class="fa fa-angle-down"></i></a><ul class="language_selection"><li><a href="#">Hindi</a></li><li><a href="#">Kannada</a></li></ul></li><li class="account"><a href="#">My Account <i class="fa fa-angle-down"></i></a><ul class="account_selection"><li><a href="user.html"><i class="fa fa-sign-in"></i>Login</a></li><li><a href="user.html"><i class="fa fa-user-plus"></i>Register</a></li></ul></li></ul></div></div></div></div></div>
        <div class="main_nav_container"><div class="container"><div class="row"><div class="col-lg-12 text-right"><div class="logo_container"><a href="index.html">Big<span>cart</span></a></div><nav class="navbar"><ul class="navbar_menu"><li><a href="index.html">home</a></li><li><a href="categories.html">shop</a></li><li><a href="#">promotion</a></li><li><a href="#">pages</a></li><li><a href="contact.html">contact</a></li></ul><ul class="navbar_user"><li><a href="#"><i class="fa fa-search"></i></a></li><li><a href="user.html"><i class="fa fa-user"></i></a></li><li class="checkout"><a href="cart.html"><i class="fa fa-shopping-cart"></i><span id="checkout_items" class="checkout_items">0</span></a></li></ul><div class="hamburger_container"><i class="fa fa-bars"></i></div></nav></div></div></div></div>
    </header>

    <!-- Login/Register Section -->
    <div class="auth_container">
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="auth_box">
                        <div class="auth_tabs">
                            <button id="loginTab" class="tab_btn active">Login</button>
                            <button id="registerTab" class="tab_btn">Register</button>
                        </div>

                        <!-- Login Form -->
                        <div id="login_tab" class="tab_content active">
                            <h2>Login to your Account</h2>
                            <!-- Message Box Added Here -->
                            <div id="message-box"></div>
                            <form id="loginForm">
                                <div class="form-group">
                                    <label for="login_identifier">Email or Phone Number</label>
                                    <input type="text" id="login_identifier" class="form-control" placeholder="Enter email or phone" required>
                                </div>
                                <div class="form-group">
                                    <label for="login_password">Password</label>
                                    <input type="password" id="login_password" class="form-control" placeholder="Enter password" required>
                                </div>
                                <button type="submit" class="red_button">Login</button>
                            </form>
                            <div class="link_text">
                                Don't have an account? <a href="#" id="switchToRegister">Register Now</a>
                            </div>
                        </div>

                        <!-- Register Form -->
                        <div id="register_tab" class="tab_content">
                            <h2>Create a New Account</h2>
                             <!-- Message Box for Registration -->
                            <div id="register-message-box"></div>
                            <form id="registerForm">
                                <div class="form-group"><label for="register_name">Full Name</label><input type="text" id="register_name" class="form-control" required></div>
                                <div class="form-group"><label for="register_dob">Date of Birth</label><input type="date" id="register_dob" class="form-control" required></div>
                                <div class="form-group"><label for="register_phone">Phone Number</label><input type="tel" id="register_phone" class="form-control" required></div>
                                <div class="form-group"><label for="register_email">Email Address</label><input type="email" id="register_email" class="form-control" required></div>
                                <div class="form-group"><label for="register_password">Create Password</label><input type="password" id="register_password" class="form-control" required></div>
                                <button type="submit" class="red_button">Register</button>
                            </form>
                            <div class="link_text">
                                Already have an account? <a href="#" id="switchToLogin">Login Here</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer"><div class="container"><div class="row"><div class="col-lg-12"><div class="footer_nav_container"><div class="cr">Â©2025 All Rights Reserved. Made with <i class="fa fa-heart-o"></i> by Colo Shop</div></div></div></div></div></footer>
</div>

<!-- Scripts -->
<script src="js/jquery-3.2.1.min.js"></script>
<script src="js/custom.js"></script>
<script>
    const loginTab = document.getElementById('loginTab');
    const registerTab = document.getElementById('registerTab');
    const loginContent = document.getElementById('login_tab');
    const registerContent = document.getElementById('register_tab');
    const switchToRegister = document.getElementById('switchToRegister');
    const switchToLogin = document.getElementById('switchToLogin');
    const messageBox = document.getElementById('message-box');
    const registerMessageBox = document.getElementById('register-message-box');

    function activate(tab) {
        if(tab==='login'){
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginContent.classList.add('active');
            registerContent.classList.remove('active');
        } else {
            registerTab.classList.add('active');
            loginTab.classList.remove('active');
            registerContent.classList.add('active');
            loginContent.classList.remove('active');
        }
    }
    loginTab.onclick = () => activate('login');
    registerTab.onclick = () => activate('register');
    switchToRegister.onclick = (e)=>{ e.preventDefault(); activate('register'); };
    switchToLogin.onclick = (e)=>{ e.preventDefault(); activate('login'); };

    function showMessage(box, message, isSuccess) {
        box.textContent = message;
        box.className = isSuccess ? 'success' : 'error';
        box.style.display = 'block';
    }

    // --- LOGIN FETCH (UPDATED) ---
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const identifier = document.getElementById('login_identifier').value;
        const password = document.getElementById('login_password').value;
        
        fetch('http://localhost:3000/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ identifier, password })
        })
        .then(async response => {
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(errorText || 'Invalid credentials');
            }
            return response.json();
        })
        .then(data => {
            if (data.user) {
                // Show success message
                showMessage(messageBox, "Login Successful! Redirecting...", true);
                
                sessionStorage.setItem('loggedInUser', JSON.stringify(data.user));

                // Redirect after a short delay
                setTimeout(() => {
                    window.location.href = 'home.html';
                }, 1500); // 1.5 second delay
            }
        })
        .catch(error => {
            showMessage(messageBox, error.message, false);
        });
    });

    // Register Fetch
    document.getElementById('registerForm').addEventListener('submit', async e=>{
        e.preventDefault();
        const name=document.getElementById('register_name').value;
        const dob=document.getElementById('register_dob').value;
        const phone=document.getElementById('register_phone').value;
        const email=document.getElementById('register_email').value;
        const password=document.getElementById('register_password').value;
        try {
            const res = await fetch('http://localhost:3000/register',{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body: JSON.stringify({name,dob,phone,email,password})
            });
            const text = await res.text();
            if(res.ok) {
                showMessage(registerMessageBox, text + " Please log in.", true);
                setTimeout(() => activate('login'), 2000);
            } else {
                throw new Error(text);
            }
        } catch(err){ 
            showMessage(registerMessageBox, err.message, false);
        }
    });
</script>
</body>
</html>
    